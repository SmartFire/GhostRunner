@{
    Layout = "~/Views/Shared/_Main.cshtml";
}
@model GhostRunner.ViewModels.History.IndexModel

<script language="javascript" type="text/javascript">
    function showScriptTaskDetail(scriptId) {
        $("#script-task-detail_" + scriptId).show();
        $("#script-task-more_" + scriptId).hide();
        $("#script-task-hide_" + scriptId).show();
    }

    function hideScriptTaskDetail(scriptId) {
        $("#script-task-detail_" + scriptId).hide();
        $("#script-task-more_" + scriptId).show();
        $("#script-task-hide_" + scriptId).hide();
    }

    $(document).ready(function () {
        $('#schedule-nav').click(function () {
            window.location.href = '@Url.Action("Index/" + Model.Project.ExternalId, "Schedules")';
        });

        $('#sequences-nav').click(function () {
            window.location.href = '@Url.Action("Index/" + Model.Project.ExternalId, "Sequences")';
        });

        $('#scripts-nav').click(function () {
            window.location.href = '@Url.Action("Index/" + Model.Project.ExternalId, "Scripts")';
        });

        $('#history-nav').click(function () {
            window.location.href = '@Url.Action("Index/" + Model.Project.ExternalId, "History")';
        });

        $('#back-to-projects').click(function () {
            window.location.href = '@Url.Action("Index", "Main")';
        });
    });
</script>

<div class="header-bar">
    <img id="logo" src="~/Images/logo.png" class="left" />
    <div id="logo-title" class="left">GhostRunner</div>
    <div id="action-container" class="right">
        <div id="user-profile-menu" class="right button-padding"><button>@Model.User.Name</button></div>
        <div class="right"><button id="back-to-projects">Back to Projects</button></div>
    </div>
    <div class="clear"></div>
</div>
<div id="page-content">
    <div id="page-navigation">
        <ul class="left">
            <li id="schedule-nav">Schedule</li>
            <li id="sequences-nav">Sequences</li>
            <li id="scripts-nav">Scripts</li>
            <li id="history-nav" class="selected">History</li>
        </ul>
        <div class="clear"></div>
    </div>
    <div id="main" class="page-panel">
        @if (Model.Tasks.Count > 0)
        {
            <div id="script-task-container">
                @foreach (Task task in Model.Tasks)
                {
                    <div class="script-task">
                        <div class="left">
                            @if (task.Status == Status.Unprocessed)
                            {<span class="status unprocessed">@task.Status.ToString()<br /><span class="date">@task.Created.ToString("MM/dd/yy hh:mm:ss tt")</span></span>}
                            else if (task.Status == Status.Processing)
                            {<span class="status processing">@task.Status.ToString()<br /><span class="date">@task.Started.Value.ToString("MM/dd/yy hh:mm tt")</span></span>}
                            else if (task.Status == Status.Completed)
                            {<span class="status completed">@task.Status.ToString()<br /><span class="date">@task.Completed.Value.ToString("MM/dd/yy hh:mm tt")</span></span>}
                            else if (task.Status == Status.Errored)
                            {<span class="status errored">@task.Status.ToString()<br /><span class="date">@task.Completed.Value.ToString("MM/dd/yy hh:mm tt")</span></span>}
                        </div>
                        <div class="left">
                            <span><b>@task.Name</b></span>
                            <br/>
                            <span id="script-task-more_@task.ExternalId" class="more" onclick="showScriptTaskDetail('@task.ExternalId')">Show detail</span>
                            <span id="script-task-hide_@task.ExternalId" class="more" onclick="hideScriptTaskDetail('@task.ExternalId')" style="display:none">Hide detail</span>
                        </div>
                        <div class="clear"></div>
                        <div id="script-task-detail_@task.ExternalId" class="detail" style="display:none">
                            @if (task.ParentType == ItemType.Script) 
                            { 
                                @Html.Partial("Partials/Script", task);
                            }
                            else if (task.ParentType == ItemType.Sequence)
                            { 
                                @Html.Partial("Partials/Sequence", task);
                            }
                            else if (task.ParentType == ItemType.SequenceScript)
                            { @Html.Partial("Partials/SequenceScript", task);
                            }
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="none-defined">No tasks have previously been ran</div>
        }
    </div>
</div>
